apiVersion: config.porch.kpt.dev/v1alpha1
kind: PackageVariant
metadata:
  name: storage-openebs-zfs
  namespace: porch-system
spec:
  upstream:
    repo: bioskop-catalog
    package: storage-openebs-zfs
  downstream:
    repo: example-state # kpt-set: ${cluster-state-repo}
    package: storage-openebs-zfs
  adoptionPolicy: adoptNone
  deletionPolicy: delete
  labels:
    nxmatic.dev/cluster: example # kpt-set: ${cluster-name}
    nxmatic.dev/component: storage
    nxmatic.dev/app: openebs-zfs
  packageContext:
    data:
      cluster-name: example # kpt-set: ${cluster-name}
      cluster-env: home # kpt-set: ${cluster-env}
  pipeline:
    mutators:
      - image: ghcr.io/kptdev/krm-functions-catalog/apply-setters:v0.2
        configMap:
          poolname: tank
          kubelet-dir: /var/lib/rancher/rke2/server/tank
---
apiVersion: config.porch.kpt.dev/v1alpha1
kind: PackageVariant
metadata:
  name: ha-kube-vip
  namespace: porch-system
spec:
  upstream:
    repo: bioskop-catalog
    package: ha/kube-vip
  downstream:
    repo: example-state # kpt-set: ${cluster-state-repo}
    package: ha/kube-vip
  adoptionPolicy: adoptNone
  deletionPolicy: delete
  labels:
    nxmatic.dev/cluster: example # kpt-set: ${cluster-name}
    nxmatic.dev/component: ha
    nxmatic.dev/app: kube-vip
  packageContext:
    data:
      cluster-name: example # kpt-set: ${cluster-name}
      cluster-env: home # kpt-set: ${cluster-env}
  pipeline:
    mutators:
      - image: ghcr.io/kptdev/krm-functions-catalog/apply-setters:v0.2
        configMap:
          kube-vip-version: v0.8.7
          cluster-vip-address: 10.0.0.1 # kpt-set: ${node-vip-ip}
          cluster-vip-interface: vmnet0
          kube-vip-namespace: kube-vip
---
apiVersion: config.porch.kpt.dev/v1alpha1
kind: PackageVariant
metadata:
  name: networking-cilium
  namespace: porch-system
spec:
  upstream:
    repo: bioskop-catalog
    package: networking/cilium
  downstream:
    repo: example-state # kpt-set: ${cluster-state-repo}
    package: networking/cilium
  adoptionPolicy: adoptNone
  deletionPolicy: delete
  labels:
    nxmatic.dev/cluster: example # kpt-set: ${cluster-name}
    nxmatic.dev/component: networking
    nxmatic.dev/app: cilium
  packageContext:
    data:
      cluster-name: example # kpt-set: ${cluster-name}
      cluster-env: home # kpt-set: ${cluster-env}
  pipeline:
    mutators:
      - image: ghcr.io/kptdev/krm-functions-catalog/apply-setters:v0.2
        configMap:
          cluster-name: example-cluster # kpt-set: ${cluster-name}-cluster
          cluster-id: "1" # kpt-set: ${cluster-id}
          lb-pool-cidr: 10.0.1.0/24 # kpt-set: ${cluster-lb-pool-cidr}
          vip-pool-cidr: 10.0.2.0/24 # kpt-set: ${cluster-vip-network-cidr}
          l2-interface-1: vmnet0
          l2-interface-2: lan0
          bgp-local-asn: "65001"
          bgp-peer-asn: "65000"
          node-gateway-ip: 10.0.0.254 # kpt-set: ${node-gateway-ip}
---
apiVersion: config.porch.kpt.dev/v1alpha1
kind: PackageVariant
metadata:
  name: mesh-tailscale
  namespace: porch-system
spec:
  upstream:
    repo: bioskop-catalog
    package: mesh/tailscale
  downstream:
    repo: example-state # kpt-set: ${cluster-state-repo}
    package: mesh/tailscale
  adoptionPolicy: adoptNone
  deletionPolicy: delete
  labels:
    nxmatic.dev/cluster: example # kpt-set: ${cluster-name}
    nxmatic.dev/component: mesh
    nxmatic.dev/app: tailscale
  packageContext:
    data:
      cluster-name: example # kpt-set: ${cluster-name}
      cluster-env: home # kpt-set: ${cluster-env}
  pipeline:
    mutators:
      - image: ghcr.io/kptdev/krm-functions-catalog/apply-setters:v0.2
        configMap:
          tailscale-version: 1.82.0
          cluster-name: example-cluster # kpt-set: ${cluster-name}-cluster
          vip-address: 10.0.0.1 # kpt-set: ${node-vip-ip}
          lb-pool-cidr: 10.0.1.0/24 # kpt-set: ${cluster-lb-pool-cidr}
          tailscale-namespace: tailscale-system
---
apiVersion: config.porch.kpt.dev/v1alpha1
kind: PackageVariant
metadata:
  name: mesh-headscale
  namespace: porch-system
spec:
  upstream:
    repo: bioskop-catalog
    package: mesh/headscale
  downstream:
    repo: example-state # kpt-set: ${cluster-state-repo}
    package: mesh/headscale
  adoptionPolicy: adoptNone
  deletionPolicy: delete
  labels:
    nxmatic.dev/cluster: example # kpt-set: ${cluster-name}
    nxmatic.dev/component: mesh
    nxmatic.dev/app: headscale
  packageContext:
    data:
      cluster-name: example # kpt-set: ${cluster-name}
      cluster-env: home # kpt-set: ${cluster-env}
  pipeline:
    mutators:
      - image: ghcr.io/kptdev/krm-functions-catalog/apply-setters:v0.2
        configMap:
          cluster-name: "example" # kpt-set: ${cluster-name}
          darwin-host: "example" # kpt-set: ${cluster-name}
          home-lan-pool: "192.168.1.0/24" # kpt-set: ${home-lan-pool}
          headscale-lb-ip: "192.168.1.10" # kpt-set: ${headscale-lb-ip}
          vip-network-cidr: "10.0.2.0/24" # kpt-set: ${cluster-vip-network-cidr}
---
apiVersion: config.porch.kpt.dev/v1alpha1
kind: PackageVariant
metadata:
  name: networking-envoy-gateway
  namespace: porch-system
spec:
  upstream:
    repo: bioskop-catalog
    package: networking/envoy-gateway
  downstream:
    repo: example-state # kpt-set: ${cluster-state-repo}
    package: networking/envoy-gateway
  adoptionPolicy: adoptNone
  deletionPolicy: delete
  labels:
    nxmatic.dev/cluster: example # kpt-set: ${cluster-name}
    nxmatic.dev/component: networking
    nxmatic.dev/app: envoy-gateway
  packageContext:
    data:
      cluster-name: example # kpt-set: ${cluster-name}
      cluster-env: home # kpt-set: ${cluster-env}
  pipeline:
    mutators:
      - image: ghcr.io/kptdev/krm-functions-catalog/apply-setters:v0.2
        configMap:
          envoy-gateway-version: v1.4.2
          envoy-gateway-namespace: envoy-gateway-system
---
apiVersion: config.porch.kpt.dev/v1alpha1
kind: PackageVariant
metadata:
  name: runtime-flox
  namespace: porch-system
spec:
  upstream:
    repo: bioskop-catalog
    package: runtime/flox-containerd-shim
  downstream:
    repo: example-state # kpt-set: ${cluster-state-repo}
    package: runtime/flox-containerd-shim
  adoptionPolicy: adoptNone
  deletionPolicy: delete
  labels:
    nxmatic.dev/cluster: example # kpt-set: ${cluster-name}
    nxmatic.dev/component: runtime
    nxmatic.dev/app: flox-containerd-shim
  packageContext:
    data:
      cluster-name: example # kpt-set: ${cluster-name}
      cluster-env: home # kpt-set: ${cluster-env}
  pipeline:
    mutators:
      - image: ghcr.io/kptdev/krm-functions-catalog/apply-setters:v0.2
        configMap:
          flox-namespace: flox
          node-label-key: flox.dev/enabled
          node-label-value: "true"
          runtime-class-name: flox
          containerd-config-file: /var/lib/rancher/rke2/agent/etc/containerd/config.toml
          containerd-address: /run/k3s/containerd/containerd.sock
          apk-max-retries: "5"
